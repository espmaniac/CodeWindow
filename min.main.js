window.addEventListener("DOMContentLoaded",(()=>{let e,t,n=!1,s=1,i=0,o=0,l=null,d=null;const c=document.getElementById("windowsContainer"),a=document.getElementById("tabs"),r={javascript:["js","mjs","cjs"],"text/x-csrc":["c","h"],"text/x-c++src":["cpp","hpp","cc","cxx"],"text/x-java":["java"],"text/x-csharp":["cs"],"text/x-python":["py"],"text/html":["html","htm"],htmlmixed:["ejs","erb","jsp","php"],"text/css":["css"],"application/json":["json"],"text/xml":["xml"],"text/x-go":["go"],"text/x-ruby":["rb","rake"],"text/plain":["txt","log","md"]};function u(e,t){const n=document.createElement("div");n.classList.add("tab"),n.innerText=e,n._windowElement=t,t._tab=n,n.addEventListener("click",(()=>{n.classList.contains("minimized")?function(e){e.style.display="block",e._tab&&(e._tab.classList.remove("minimized"),e._tab.classList.add("active"),d=e._tab);e.classList.add("active"),l=e;const t=e._container,n=e._editor,i=600,o=360;t.style.width=i*s+"px",t.style.height=o*s+"px";const c=n.getWrapperElement();c.style.width="100%",c.style.height="100%",c.style.fontSize=14*s+"px",n.refresh();const a=e.querySelector(".window-header").offsetHeight;e.style.width=t.offsetWidth+"px",e.style.height=t.offsetHeight+a+"px"}(t):(d&&d.classList.remove("active"),n.classList.add("active"),d=n,l!==t&&(l&&l.classList.remove("active"),t.classList.add("active"),l=t))})),a.appendChild(n),d||(n.classList.add("active"),d=n)}function m(e,t){const a=document.createElement("div");a.classList.add("window");const m=document.createElement("div");m.classList.add("window-header"),m.innerText=e;const p=document.createElement("button");p.classList.add("close-btn"),p.innerText="X",p.addEventListener("click",(()=>{a._resizeObserver.disconnect(),a.remove(),a._tab&&(a._tab.remove(),d===a._tab&&(d=null)),l===a&&(l=null);const e=document.querySelectorAll(".window");if(e.length>0){const t=e[e.length-1];t.classList.add("active"),l=t;const n=t._tab;n&&(n.classList.add("active"),d=n)}}));const f=document.createElement("button");f.classList.add("minimize-btn"),f.innerText="_",f.addEventListener("click",(()=>{a.style.display="none",a._tab&&(a._tab.classList.remove("active"),a._tab.classList.add("minimized")),l===a&&(l=null),d===a._tab&&(d=null)}));a.style.left=-i+(window.innerWidth-600)/2+"px",a.style.top=-o+(window.innerHeight-360)/2+"px";const h=document.createElement("div");h.classList.add("editor-container"),h.style.width=600*s+"px",h.style.height=360*s+"px",h.style.resize="both",h.style.overflow="hidden",a.appendChild(m),a.appendChild(p),a.appendChild(f),a.appendChild(h),c.appendChild(a),u(e,a),l&&l.classList.remove("active"),a.classList.add("active"),l=a,function(e){const t=e.querySelector(".window-header");let s,i,o,d,c=!1,a=!1;t.style.cursor="grab",t.addEventListener("mousedown",(r=>{0===r.button&&(a=!0,l!==e&&(e.classList.add("active"),l&&l.classList.remove("active"),l=e),n||(c=!0,s=r.clientX,i=r.clientY,o=e.offsetLeft,d=e.offsetTop,t.style.cursor="grabbing"),r.preventDefault())})),document.addEventListener("mousemove",(t=>{if(!c||n)return;const l=t.clientX-s,a=t.clientY-i;e.style.left=o+l+"px",e.style.top=d+a+"px"})),document.addEventListener("mouseup",(e=>{0===e.button&&(a=!1,c=!1,t.style.cursor="grab")}));const r=(n,r)=>{a&&(c=!0,s=n,i=r,o=e.offsetLeft,d=e.offsetTop,t.style.cursor="grabbing",e.classList.add("active"),l&&l!==e&&l.classList.remove("active"),l=e)};e._onPanEnd=r}(a),function(e,t,n=""){const i=function(e){const t=e.split(".").pop().toLowerCase();for(const[e,n]of Object.entries(r))if(n.includes(t))return e;return"text/plain"}(n),o=CodeMirror(t,{mode:i,lineNumbers:!0,value:"",viewportMargin:1/0});o.setOption("theme","isotope");const l=o.getWrapperElement();l.style.width="100%",l.style.height="100%",l.style.fontSize=14*s+"px",o.refresh();const d=new ResizeObserver((()=>{const n=t.getBoundingClientRect(),s=e.querySelector(".window-header").offsetHeight;e.style.width=n.width+"px",e.style.height=n.height+s+"px",o.refresh()}));d.observe(t),e._editor=o,e._container=t,e._resizeObserver=d}(a,h,e),a._editor.setValue(t),a.dataset.scale=s}function p(e){const t=e._editor,n=e.querySelector(".window-header").innerText||"untitled.txt",s=t.getValue(),i=new Blob([s],{type:"text/plain;charset=utf-8"}),o=document.createElement("a");o.href=URL.createObjectURL(i),o.download=n,document.body.appendChild(o),o.click(),document.body.removeChild(o)}document.addEventListener("wheel",(e=>{if(e.altKey)return;e.preventDefault();const t=e.deltaY>0?.9:1.1;!function(e,t,n){const i=(n=Math.min(Math.max(n,.5),3))/s;s=n,document.querySelectorAll(".window").forEach((n=>{if("none"===n.style.display)return;const o=n._container,l=n._editor,d=n.getBoundingClientRect(),c=e-d.left,a=t-d.top,r=o.offsetWidth*i,u=o.offsetHeight*i;o.style.width=r+"px",o.style.height=u+"px";const m=l.getWrapperElement();m.style.width="100%",m.style.height="100%",m.style.fontSize=14*s+"px",l.refresh();const p=n.querySelector(".window-header").offsetHeight;n.style.width=o.offsetWidth+"px",n.style.height=o.offsetHeight+p+"px";const f=c*(i-1),h=a*(i-1);n.style.left=n.offsetLeft-f+"px",n.style.top=n.offsetTop-h+"px"}))}(e.clientX,e.clientY,s*t)}),{passive:!1}),document.addEventListener("mousedown",(s=>{1===s.button&&(n=!0,e=s.clientX,t=s.clientY,s.preventDefault())})),document.addEventListener("mousemove",(s=>{if(!n)return;const l=s.clientX-e,d=s.clientY-t;i+=l,o+=d,c.style.transform=`translate(${i}px, ${o}px)`,e=s.clientX,t=s.clientY})),document.addEventListener("mouseup",(s=>{1===s.button&&(n=!1,e=t=null,document.querySelectorAll(".window").forEach((e=>{e._onPanEnd&&e._onPanEnd(s.clientX,s.clientY)})))})),document.getElementById("createWindowBtn").addEventListener("click",(()=>{let e=prompt("Enter file name:");e&&m(e,"")})),document.getElementById("openFileBtn").addEventListener("click",(()=>{document.getElementById("fileInput").click()})),document.getElementById("fileInput").addEventListener("change",(e=>{const t=e.target.files[0];if(t){const e=new FileReader;e.onload=e=>m(t.name,e.target.result),e.readAsText(t)}})),document.addEventListener("dragover",(e=>e.preventDefault())),document.addEventListener("drop",(e=>{e.preventDefault();Array.from(e.dataTransfer.files).forEach((e=>{const t=new FileReader;t.onload=t=>m(e.name,t.target.result),t.readAsText(e)}))})),document.getElementById("saveFileBtn").addEventListener("click",(()=>{const e=Array.from(document.querySelectorAll(".window"));if(!e.length)return alert("No open windows to save.");const t=prompt("Enter 1 to save current file or 2 to save all files:","1");if("1"===t||"2"===t)if("1"===t){if(!l)return alert("No active window to save.");p(l)}else e.forEach((e=>p(e)))}))}));